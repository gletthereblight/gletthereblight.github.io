<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  
  <title>Shell 命令之 awk | Glett的码字间</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <meta name="description" content="awk 命令介绍和使用">
<meta property="og:type" content="article">
<meta property="og:title" content="Shell 命令之 awk">
<meta property="og:url" content="http://example.com/2021/02/03/%E7%9F%A5%E8%AF%86%E7%82%B9/Linux/shell/shell-awk/index.html">
<meta property="og:site_name" content="Glett的码字间">
<meta property="og:description" content="awk 命令介绍和使用">
<meta property="og:locale" content="zh_CN">
<meta property="article:published_time" content="2021-02-03T01:13:00.000Z">
<meta property="article:modified_time" content="2023-03-02T03:47:00.000Z">
<meta property="article:author" content="Gao Peng">
<meta name="twitter:card" content="summary">
  
    <link rel="alternate" href="/atom.xml" title="Glett的码字间" type="application/atom+xml">
  
  
    <link rel="shortcut icon" href="/favicon.png">
  
  
    
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/typeface-source-code-pro@0.0.71/index.min.css">

  
  
<link rel="stylesheet" href="/css/style.css">

  
    
<link rel="stylesheet" href="/fancybox/jquery.fancybox.min.css">

  
  
<meta name="generator" content="Hexo 6.3.0"></head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">Glett的码字间</a>
      </h1>
      
        <h2 id="subtitle-wrap">
          <a href="/" id="subtitle">理想三旬</a>
        </h2>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"><span class="fa fa-bars"></span></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
        
          <a class="nav-icon" href="/atom.xml" title="RSS 订阅"><span class="fa fa-rss"></span></a>
        
        <a class="nav-icon nav-search-btn" title="搜索"><span class="fa fa-search"></span></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="搜索"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://example.com"></form>
      </div>
    </div>
  </div>
</header>

      <div class="outer">
        <section id="main"><article id="post-知识点/Linux/shell/shell-awk" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2021/02/03/%E7%9F%A5%E8%AF%86%E7%82%B9/Linux/shell/shell-awk/" class="article-date">
  <time class="dt-published" datetime="2021-02-03T01:13:00.000Z" itemprop="datePublished">2021-02-03</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 class="p-name article-title" itemprop="headline name">
      Shell 命令之 awk
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h2 id="1-wiki"><a href="#1-wiki" class="headerlink" title="1. wiki"></a>1. wiki</h2><p><code>awk</code> 可以理解一种编程语言，其对输入数据的每一行都进行文本处理，并内建一些数据结构和函数，在熟悉者手中十分灵活</p>
<h2 id="2-语法"><a href="#2-语法" class="headerlink" title="2. 语法"></a>2. 语法</h2><p>基本语法框架为，其由选项、脚本和输入的数据等组成</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">awk [options] &#x27;[scripts]&#x27; [files]</span><br></pre></td></tr></table></figure>

<h3 id="1-options"><a href="#1-options" class="headerlink" title="1. options"></a>1. options</h3><p>常用的选项主要有 3 个，更多选项可以使用 <code>--help</code> 查看</p>
<ul>
<li><code>-f [progfile]</code> , <code>--file=[progfile]</code> : 从脚本文件 <code>progfile</code> 中读取事先写好的 awk 命令</li>
<li><code>-F [fs]</code> , <code>--field-separator=[fs]</code> : 指定输入中的分隔符，<code>fs</code> 可以是字符串或正则表达式，特殊字符可以使用转义</li>
<li><code>-v [var=value]</code> , <code>--asign=[var=value]</code> : 给自定义变量赋值，将外部变量传递给 awk</li>
</ul>
<h3 id="2-scripts"><a href="#2-scripts" class="headerlink" title="2. scripts"></a>2. scripts</h3><p>基本语法结构为，脚本通常由模式和命令两部分组成，可以省略其一，但不能同时被省略，其包裹在单引号 <code>&#39;&#39;</code> 或双引号 <code>&quot;&quot;</code> 中。注意，与 shell 的用法一致，在使用单引号 <code>&#39;&#39;</code> 时，变量不会被解释，双引号 <code>&quot;&quot;</code> 中变量则会被替换成相应结果</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pattern&#123;commands&#125;</span><br></pre></td></tr></table></figure>

<h4 id="1-模式"><a href="#1-模式" class="headerlink" title="1. 模式"></a>1. 模式</h4><p>模式可以是很多种，一般情况下，每碰到一个使模式表达式为真的输入行，命令就会执行</p>
<ul>
<li>正则表达式 : 语法为 <code>/r/</code>，支持常用的通配符，也可以使用 <code>exp ~ /r/</code> 或 <code>exp !~ /r/</code> 表达包含和不包含</li>
<li>逻辑表达式 : 大于(<code>&gt;</code>)、小于(<code>&lt;</code>)、等于(<code>==</code>)、且(<code>&amp;&amp;</code>)、或(<code>||</code>)、否(<code>!</code>)等</li>
<li><code>BEGIN&#123;&#125;</code> : 特殊模式，其不匹配任何输入行，只在开头执行一次，一般用作变量初始化、打印输表头等操作</li>
<li><code>END&#123;&#125;</code> : 特殊模式，其不匹配任何输入行，只在结束执行一次，一般用来打印结果等操作</li>
</ul>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">读取 : 分隔的文件 passwd，取以 root 或 ftp 开头的行，并打印</span></span><br><span class="line">awk -F : &#x27;/^root|^ftp/&#123;print&#125;&#x27; /etc/passwd</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">读取 | 分隔的文件 output.log，取行号大于 3 的行，并打印第行号和第一个字段</span></span><br><span class="line">awk -F \| &#x27;NR &gt; 3&#123;print NR,$1&#125;&#x27; output.log</span><br></pre></td></tr></table></figure>

<h4 id="2-命令"><a href="#2-命令" class="headerlink" title="2. 命令"></a>2. 命令</h4><p>命令支持很多形式，包括变量或数组赋、内置函数、控制流语句等，其格式也有一定要求：</p>
<ul>
<li>一行可包含若干条语句，使用分号分开即可 </li>
<li>命令的左花括号必须与它的模式在同一行，空行会被忽略</li>
<li>注释可以出现在任意一行的末尾，一个注释以井号 (#) 开始，以换行符结束</li>
<li>一条长语句可以分散成多行，只要在断行处插入一个反斜杠即可</li>
</ul>
<h2 id="3-内建变量"><a href="#3-内建变量" class="headerlink" title="3. 内建变量"></a>3. 内建变量</h2><p>awk 会统计一些元数据信息，并存入内建变量中，常用的有</p>
<ul>
<li><code>$0</code> : 完整的输入记录</li>
<li><code>$n</code> : 当前记录的由 FS 分隔的第 n 个字段，如 $1 表示第一个字段</li>
<li><code>FS</code> : 字段分隔符，默认是任一空格</li>
<li><code>NR</code> : 表示记录数，在执行过程中对应于当前的行号</li>
<li><code>NF</code> : 表示字段数，在记录被读之后重置为1，如 $NF 为最后一个字段</li>
<li><code>FNR</code> : 同 <code>NR</code>，但相对于当前文件</li>
<li><code>FILENAME</code> : 当前输入文件的名</li>
</ul>
<p>其他变量的详情，可以使用 <code>man awk</code> 来查看，也可以使用命令 <code>awk --dump-variables &#39;&#39;</code>，会将部分可用的变量输出到 <code>awkvars.out</code> 文件中</p>
<ul>
<li><code>ARGC</code> : 命令行参数的数目。</li>
<li><code>ARGV</code> : 命令行参数数组</li>
<li><code>ARGIND</code> : 命令行中当前文件的位置，主要针对多个文件的输入</li>
<li><code>CONVFMT</code> : 数字转换格式，默认值为 <code>%.6g</code></li>
<li><code>ERRNO</code> : 最后一个系统错误的描述</li>
<li><code>FIELDWIDTHS</code> : 字段宽度列表，用空格分隔</li>
<li><code>FNR</code> : 同 <code>NR</code>，但相对于当前文件</li>
<li><code>IGNORECASE</code> : 为真，则进行忽略大小写的匹配，默认为假</li>
<li><code>OFMT</code> : 数字的输出格式，默认为 <code>%.6g</code></li>
<li><code>OFS</code> : 输出字段分隔符，默认为空格</li>
<li><code>ORS</code> : 输出记录分隔符，默认为换行符</li>
<li><code>RS</code> : 记录分隔符，默认为换行符</li>
<li><code>RLENGTH</code> : 由 match 函数所匹配的字符串的长度</li>
<li><code>RSTART</code> : 由 match 函数所匹配的字符串的第一个位置</li>
<li><code>SUBSEP</code> : 数组下标分隔符，默认为 <code>\034</code></li>
</ul>
<h2 id="4-内建函数"><a href="#4-内建函数" class="headerlink" title="4. 内建函数"></a>4. 内建函数</h2><h3 id="1-字符串函数"><a href="#1-字符串函数" class="headerlink" title="1. 字符串函数"></a>1. 字符串函数</h3><ul>
<li><code>gsub(Ere, Repl, [ In ] )</code> : 除了正则表达式所有具体值被替代这点，它和 sub 函数完全一样地执行。</li>
<li><code>index(s, t)</code>	: 返回 t 在 s 中出现的位置索引，不存在则返回 0，从 1 开始</li>
<li><code>length ([s])</code> : 返回字符串 s 的长度，如果没有，则返回整条记录长度($0)，数组的话则返回数组元素数量</li>
<li><code>match( String, Ere )</code>	在 String 参数指定的字符串（Ere 参数指定的扩展正则表达式出现在其中）中返回位置（字符形式），从 1 开始编号，或如果 Ere 参数不出现，则返回 0（零）。RSTART 特殊变量设置为返回值。RLENGTH 特殊变量设置为匹配的字符串的长度，或如果未找到任何匹配，则设置为 -1（负一）。</li>
<li><code>split(s, a [, r [, seps]])</code> : 使用正则表达式 r 将字符串 s 拆分为数组 a 和分隔符数组 seps，并返回字段数。如果 r 省略，则使用 FS</li>
<li><code>sprintf(fmt, expr-list)</code>	: 格式化表达式</li>
<li><code>sub(Ere, Repl, [ In ] )</code> : 用 Repl 参数指定的字符串替换 In 参数指定的字符串中的由 Ere 参数指定的扩展正则表达式的第一个具体值。sub 函数返回替换的数量。出现在 Repl 参数指定的字符串中的 &amp;（和符号）由 In 参数指定的与 Ere 参数的指定的扩展正则表达式匹配的字符串替换。如果未指定 In 参数，缺省值是整个记录（$0 记录变量）。</li>
<li><code>substr(s, i [, n])</code> : 从字符串 s 的 i 位置开始，返回最多 n 长度的子字符串，如果省略 n，则返回剩下的全部</li>
<li><code>tolower(str)</code> : 返回将 str 所有字符的小写形式字符串，其与大小写与当前环境有关</li>
<li><code>toupper(str)</code> : 返回将 str 所有字符的大写形式字符串，其与大小写与当前环境有关</li>
</ul>
<h3 id="2-算术函数"><a href="#2-算术函数" class="headerlink" title="2. 算术函数"></a>2. 算术函数</h3><ul>
<li><code>atan2(y, x)</code> : 返回 y&#x2F;x 的反正切弧度表示</li>
<li><code>cos(expr)</code> : 弧度的余弦</li>
<li><code>exp(expr)</code> : 幂函数</li>
<li><code>int(expr)</code> : 截断至整数的值</li>
<li><code>log(expr)</code> : 自然对数函数</li>
<li><code>rand()</code> : 随机数，值域为 [0, 1)</li>
<li><code>sin(expr)</code> : 弧度的正弦</li>
<li><code>sqrt(expr)</code> : 平方根函数</li>
<li><code>srand([expr])</code> : 使用 expr 作为种子的随机函数，如果省略 expr 参数，则使用日期中的天。返回值是先前种子</li>
</ul>
<h3 id="3-一般函数"><a href="#3-一般函数" class="headerlink" title="3. 一般函数"></a>3. 一般函数</h3><ul>
<li><code>close( Expression )</code>	用同一个带字符串值的 Expression 参数来关闭由 print 或 printf 语句打开的或调用 getline 函数打开的文件或管道。如果文件或管道成功关闭，则返回 0；其它情况下返回非零值。如果打算写一个文件，并稍后在同一个程序中读取文件，则 close 语句是必需的。</li>
<li><code>system(command )</code>	执行 Command 参数指定的命令，并返回退出状态。等同于 system 子例程。</li>
<li><code>Expression | getline [ Variable ]</code>	从来自 Expression 参数指定的命令的输出中通过管道传送的流中读取一个输入记录，并将该记录的值指定给 Variable 参数指定的变量。如果当前未打开将 Expression 参数的值作为其命令名称的流，则创建流。创建的流等同于调用 popen 子例程，此时 Command 参数取 Expression 参数的值且 Mode 参数设置为一个是 r 的值。只要流保留打开且 Expression 参数求得同一个字符串，则对 getline 函数的每次后续调用读取另一个记录。如果未指定 Variable 参数，则 $0 记录变量和 NF 特殊变量设置为从流读取的记录。</li>
<li><code>getline [ Variable ] &lt; Expression</code>	从 Expression 参数指定的文件读取输入的下一个记录，并将 Variable 参数指定的变量设置为该记录的值。只要流保留打开且 Expression 参数对同一个字符串求值，则对 getline 函数的每次后续调用读取另一个记录。如果未指定 Variable 参数，则 $0 记录变量和 NF 特殊变量设置为从流读取的记录。</li>
<li><code>getline [ Variable ]</code>	将 Variable 参数指定的变量设置为从当前输入文件读取的下一个输入记录。如果未指定 Variable 参数，则 $0 记录变量设置为该记录的值，还将设置 NF、NR 和 FNR 特殊变量。</li>
</ul>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2021/02/03/%E7%9F%A5%E8%AF%86%E7%82%B9/Linux/shell/shell-awk/" data-id="cll6dbyos00089cjw5qbb9bwa" data-title="Shell 命令之 awk" class="article-share-link"><span class="fa fa-share">分享</span></a>
      
      
      
    </footer>
  </div>
  
    
<nav id="article-nav">
  
    <a href="/2021/02/19/%E7%9F%A5%E8%AF%86%E7%82%B9/%E6%95%B0%E6%8D%AE%E5%BA%93/Oracle/8.%E5%AD%98%E5%82%A8%E8%BF%87%E7%A8%8B/" id="article-nav-newer" class="article-nav-link-wrap">
      <strong class="article-nav-caption">前一篇</strong>
      <div class="article-nav-title">
        
          Oracle 存储过程
        
      </div>
    </a>
  
  
    <a href="/2021/01/27/%E7%9F%A5%E8%AF%86%E7%82%B9/%E5%89%8D%E7%AB%AF/CSS/%E5%8D%95%E4%BD%8D/" id="article-nav-older" class="article-nav-link-wrap">
      <strong class="article-nav-caption">后一篇</strong>
      <div class="article-nav-title">CSS 中常用单位</div>
    </a>
  
</nav>

  
</article>


</section>
        
          <aside id="sidebar">
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">关于我</h3>
      <ul class="widget about">
      
      
      <li>专业泼冷水，执着负能量</li>
      
    </ul>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">最近更新</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2021/12/01/%E7%9F%A5%E8%AF%86%E7%82%B9/Java/%E6%9C%AF%E8%AF%AD/5.JVM%E8%B0%83%E4%BC%98/">JVM 调优</a>
          </li>
        
          <li>
            <a href="/2023/08/30/%E8%AF%BB%E4%B9%A6%E7%AC%94%E8%AE%B0/DAMA-DMBOK2/CDGA%E5%86%B2%E5%88%BA-01%E6%95%B0%E6%8D%AE%E7%AE%A1%E7%90%86/">CDGA 章节重点冲刺系列-第一章 数据管理</a>
          </li>
        
          <li>
            <a href="/2023/02/16/%E7%9F%A5%E8%AF%86%E7%82%B9/Java/Spring/2.SpringBoot%E6%8E%A5%E5%8F%A3%E5%92%8C%E6%8A%BD%E8%B1%A1%E7%B1%BB/">Spring Boot 接口和抽象类</a>
          </li>
        
          <li>
            <a href="/2019/11/13/%E7%9F%A5%E8%AF%86%E7%82%B9/Linux/1.%E5%B7%B2%E6%95%B4%E7%90%86%E5%91%BD%E4%BB%A4/">Linux 常用命令(持续更新)</a>
          </li>
        
          <li>
            <a href="/2021/12/16/%E7%9F%A5%E8%AF%86%E7%82%B9/Java/%E7%AC%AC%E4%B8%89%E6%96%B9%E5%8C%85/06.%E6%B5%8B%E8%AF%95%E6%A1%86%E6%9E%B6/">Java 第三方包-测试框架</a>
          </li>
        
      </ul>
    </div>
  </div>

  
    

  
    

  
    
  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      
      &copy; 2023 Gao Peng<br>
      Powered by <a href="https://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>

    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    


<script src="/js/jquery-3.6.4.min.js"></script>



  
<script src="/fancybox/jquery.fancybox.min.js"></script>




<script src="/js/script.js"></script>





  </div>
</body>
</html>